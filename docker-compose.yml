services:
  relay:
    build:
      context: ./relay
      dockerfile: Dockerfile
    image: risk-v-relay:latest
    # Uncomment and adjust the following lines if you want to use a persistent
    # TLS certificate instead of generating a new self-signed one each time.
    volumes:
      - ./certs/relay-cert.pem:/etc/relay/cert.pem:ro
      - ./certs/relay-key.pem:/etc/relay/key.pem:ro
    environment:
      RELAY_CERT_PEM: /etc/relay/cert.pem
      RELAY_KEY_PEM: /etc/relay/key.pem
    ports:
      - "4433:4433/udp"
    restart: unless-stopped

  web:
    build:
      context: .
      dockerfile: web/Dockerfile
      args:
        NEXT_PUBLIC_RELAY_URL: "https://localhost:4433"
        NEXT_PUBLIC_RELAY_CERT_HASH: "28:ae:05:bc:67:0f:67:75:28:ad:d6:e6:4e:12:20:52:61:64:4d:78:95:0e:df:c1:fe:43:16:29:f4:26:ce:30"
    image: risk-v-web:latest
    depends_on:
      - relay
    environment:
      NEXT_PUBLIC_RELAY_URL: "https://localhost:4433"
      NEXT_PUBLIC_RELAY_CERT_HASH: "28:ae:05:bc:67:0f:67:75:28:ad:d6:e6:4e:12:20:52:61:64:4d:78:95:0e:df:c1:fe:43:16:29:f4:26:ce:30"
    ports:
      - "3000:3000"
    restart: unless-stopped


